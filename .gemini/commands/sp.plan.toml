description = "Execute the implementation planning workflow for the Book RAG project, generating design artifacts for the specified tech stack."

prompt = """
---
description: "Execute the implementation planning workflow for the Book RAG project, generating design artifacts for the Docusaurus, Gemini, Neon, and Qdrant stack."
---

## User Input

```text
$ARGUMENTS
```

You **MUST** consider the user input before proceeding (if not empty).

## Outline

1.  **Setup**: Run `.specify/scripts/powershell/setup-plan.ps1 -Json` to get the feature context.

2.  **Load Context**:
    *   Read the feature specification (`FEATURE_SPEC`).
    *   Read the Book RAG constitution (`.specify/memory/constitution.md`).
    *   Load the implementation plan template (`IMPL_PLAN`).

3.  **Execute Plan Workflow**: Follow the structure in the `IMPL_PLAN` template to:
    *   **Fill Technical Context**: Detail how the new feature will interact with Docusaurus, Gemini, Neon, and Qdrant. Mark any unknowns as "NEEDS CLARIFICATION".
    *   **Fill Constitution Check**: Verify that the plan adheres to the principles of the Book RAG constitution.
    *   **Evaluate Gates**: Halt with an error if the plan violates the constitution without a clear justification.
    *   **Phase 0: Research**: Generate `research.md` to resolve any "NEEDS CLARIFICATION" items. For example, research the best way to integrate `openai-chatkit` with Docusaurus.
    *   **Phase 1: Design & Contracts**:
        *   Generate `data-model.md` with schemas for the Neon database (e.g., user tables) and Qdrant (e.g., vector metadata).
        *   Generate API contracts in the `contracts/` directory for the backend services that will power the chat.
    *   **Re-evaluate Constitution Check**: Ensure the final design is compliant.

4.  **Stop and Report**: The command ends after the planning phase is complete. Report the branch, the path to the `plan.md`, and a list of the generated artifacts.

## Phases

### Phase 0: Outline & Research

-   **Extract unknowns**: Identify any ambiguities in how to use the project's tech stack for the given feature.
-   **Generate research tasks**: Create research tasks to find best practices, for example:
    - "Find best practices for chunking and embedding technical documentation for a RAG system."
    - "Investigate methods for securing the AI backend API."
-   **Consolidate findings**: Document the decisions and rationale in `research.md`.

### Phase 1: Design & Contracts

-   **Prerequisites**: `research.md` is complete.
-   **Data Model**: Extract entities from the feature spec and define their structure in `data-model.md`. This includes relational data in Neon and vector data in Qdrant.
-   **API Contracts**: Generate OpenAPI schemas for the backend services that will interact with the Gemini model and the databases.

## Key Rules

-   All planning must adhere to the Book RAG constitution.
-   Any deviation from the core tech stack must be justified and documented in an ADR.

---

As the main request completes, you MUST create and complete a PHR (Prompt History Record).
"""