description = "Create or update a feature specification for the Book RAG project from a natural language description."

prompt = """
---
description: "Create or update a feature specification for the Book RAG project from a natural language description, ensuring it aligns with the project's architecture."
---

## User Input

```text
$ARGUMENTS
```

You **MUST** consider the user input before proceeding (if not empty).

## Outline

The text the user typed after `/sp.specify` is the feature description.

Given that feature description, do this:

1.  **Generate a concise short name** (2-4 words) for the branch. The name should be relevant to the Book RAG project.
    *   Examples: "rag-pipeline-update", "docusaurus-chat-ui", "user-auth-neon"

2.  **Create a new feature branch** by running the `.specify/scripts/powershell/create-new-feature.ps1` script.

3.  **Load the spec template** (`.specify/templates/spec-template.md`).

4.  **Follow this execution flow**:

    1.  **Parse the user's description** to extract key concepts related to the Book RAG project (e.g., AI, chat, search, content).
    2.  **Identify actors** (e.g., reader, author, admin), actions, data, and constraints.
    3.  **For unclear aspects**, make informed guesses based on the project's constitution. Mark a maximum of 3 items with `[NEEDS CLARIFICATION]`. Prioritize clarifications for core RAG functionality, data handling, and security.
    4.  **Fill the User Scenarios & Testing section** with scenarios relevant to a user interacting with the AI-powered book.
    5.  **Generate Functional Requirements** that are testable and specific to the feature.
    6.  **Define Success Criteria** with measurable outcomes (e.g., "p95 query latency < 2 seconds", "search recall > 90%").
    7.  **Identify Key Entities** for both the Neon database and the Qdrant vector database.

5.  **Write the specification** to the `SPEC_FILE` path returned by the script.

6.  **Specification Quality Validation**: After writing the spec, validate it against a quality checklist.
    *   **Create a Spec Quality Checklist** at `FEATURE_DIR/checklists/requirements.md`.
    *   The checklist should ensure that the spec is free of implementation details and that the requirements are complete, testable, and measurable.
    *   If there are `[NEEDS CLARIFICATION]` markers, present the user with targeted questions about the RAG pipeline, data model, or UI.

7.  **Report completion** with the branch name, spec file path, and readiness for the next phase (`/sp.clarify` or `/sp.plan`).

## General Guidelines for Book RAG Specs

-   **Focus on WHAT and WHY**: What does the user want to achieve with the AI book? Why is it important?
-   **Avoid HOW**: Do not mention specific code, libraries, or implementation details unless it's a core architectural constraint from the constitution.
-   **Success Criteria**: Must be measurable and technology-agnostic.
    -   **Good**: "Users receive an answer to their query within 3 seconds."
    -   **Bad**: "The Gemini API responds in under 500ms."

---

As the main request completes, you MUST create and complete a PHR (Prompt History Record).
"""