description = "Generate an actionable, dependency-ordered tasks.md for a feature in the Book RAG project."

prompt = """
---
description: "Generate an actionable, dependency-ordered tasks.md for a feature in the Book RAG project, based on the available design artifacts."
---

## User Input

```text
$ARGUMENTS
```

You **MUST** consider the user input before proceeding (if not empty).

## Outline

1.  **Setup**: Run `.specify/scripts/powershell/check-prerequisites.ps1 -Json` to load the feature context.

2.  **Load Design Documents**:
    *   **Required**: `plan.md` (tech stack: Docusaurus, Gemini, Neon, Qdrant), `spec.md` (user stories).
    *   **Optional**: `data-model.md` (schemas for Neon and Qdrant), `contracts/` (API definitions).

3.  **Execute Task Generation Workflow**:
    *   Load the `plan.md` and `spec.md` to understand the architecture and user stories.
    *   Generate tasks organized by user story.
    *   Generate a dependency graph showing the order of implementation.

4.  **Generate `tasks.md`**: Use the `.specify/templates/tasks-template.md` structure to create a detailed task list.
    *   **Phase 1: Setup**: Tasks for initializing the database connections, configuring the AI model, etc.
    *   **Phase 2: Foundational Tasks**: Blocking prerequisites, such as setting up the authentication middleware.
    *   **Phase 3+: User Stories**: One phase per user story, in priority order.
    *   **Final Phase: Polish**: Cross-cutting concerns like performance optimization and final testing.

5.  **Report**: Output the path to the generated `tasks.md` and a summary of the plan.

## Task Generation Rules for Book RAG

**CRITICAL**: Tasks MUST be organized by user story to enable independent implementation and testing.

### Checklist Format (REQUIRED)

Every task MUST strictly follow this format:

` - [ ] [TaskID] [P?] [Story?] Description with file path`

**Format Components**:

1.  **Checkbox**: `- [ ]`
2.  **Task ID**: `T001`, `T002`, etc.
3.  **[P] marker**: For parallelizable tasks.
4.  **[Story] label**: `[US1]`, `[US2]`, etc.
5.  **Description**: Clear action with the exact file path.

**Examples for Book RAG**:

-   ` - [ ] T001 Initialize Neon DB client in src/lib/db.ts`
-   ` - [ ] T002 [P] Configure Qdrant client in src/lib/qdrant.ts`
-   ` - [ ] T010 [US1] Create the React component for the chat widget in src/components/ChatWidget.tsx`
-   ` - [ ] T011 [US1] Implement the backend API route for handling chat messages in src/pages/api/chat.ts`
-   ` - [ ] T012 [US1] Implement the RAG pipeline logic in src/server/rag.ts`

### Task Organization

-   **From User Stories**: Each user story from `spec.md` gets its own phase.
-   **From Contracts**: API endpoints are mapped to the user stories they serve.
-   **From Data Model**: Tasks for creating or modifying Neon DB tables or Qdrant collections are placed in the appropriate user story phase.
-   **From Setup/Infrastructure**: Shared setup tasks go into Phase 1.

---

As the main request completes, you MUST create and complete a PHR (Prompt History Record).
"""