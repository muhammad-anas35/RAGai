"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[4817],{4582:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"physical-ai-book/chapter2/nodes-communication","title":"2.2 Nodes and Communication","description":"Learning Objectives","source":"@site/docs/physical-ai-book/chapter2/nodes-communication.md","sourceDirName":"physical-ai-book/chapter2","slug":"/physical-ai-book/chapter2/nodes-communication","permalink":"/docs/physical-ai-book/chapter2/nodes-communication","draft":false,"unlisted":false,"editUrl":"https://github.com/muhammad-anas35/RAGai/tree/main/docs/physical-ai-book/chapter2/nodes-communication.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"2.4 Launch Files and Parameter Management","permalink":"/docs/physical-ai-book/chapter2/launch"},"next":{"title":"Chapter 2: ROS 2 Fundamentals - Overview","permalink":"/docs/physical-ai-book/chapter2/overview"}}');var i=r(4848),t=r(8453);const o={},c="2.2 Nodes and Communication",l={},a=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Understanding Nodes",id:"understanding-nodes",level:2},{value:"What is a Node?",id:"what-is-a-node",level:3},{value:"Node Lifecycle",id:"node-lifecycle",level:3},{value:"Topics: Publish-Subscribe Communication",id:"topics-publish-subscribe-communication",level:2},{value:"When to Use Topics",id:"when-to-use-topics",level:3},{value:"Creating a Publisher (Python)",id:"creating-a-publisher-python",level:3},{value:"Creating a Subscriber (Python)",id:"creating-a-subscriber-python",level:3},{value:"Running the Example",id:"running-the-example",level:3},{value:"Services: Request-Reply Communication",id:"services-request-reply-communication",level:2},{value:"When to Use Services",id:"when-to-use-services",level:3},{value:"Creating a Service Server (Python)",id:"creating-a-service-server-python",level:3},{value:"Creating a Service Client (Python)",id:"creating-a-service-client-python",level:3},{value:"Running the Service Example",id:"running-the-service-example",level:3},{value:"Actions: Long-Running Tasks with Feedback",id:"actions-long-running-tasks-with-feedback",level:2},{value:"When to Use Actions",id:"when-to-use-actions",level:3},{value:"Action Structure",id:"action-structure",level:3},{value:"Creating an Action Server (Python)",id:"creating-an-action-server-python",level:3},{value:"Creating an Action Client (Python)",id:"creating-an-action-client-python",level:3},{value:"Topics vs. Services vs. Actions",id:"topics-vs-services-vs-actions",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Reflection Questions",id:"reflection-questions",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"22-nodes-and-communication",children:"2.2 Nodes and Communication"})}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsx)(n.p,{children:"By the end of this section, you will be able to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create and manage ROS 2 nodes in Python and C++"}),"\n",(0,i.jsx)(n.li,{children:"Implement publishers and subscribers for topic-based communication"}),"\n",(0,i.jsx)(n.li,{children:"Use services for request-reply interactions"}),"\n",(0,i.jsx)(n.li,{children:"Implement actions for long-running tasks with feedback"}),"\n",(0,i.jsx)(n.li,{children:"Understand when to use topics vs. services vs. actions"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Nodes"})," are the fundamental building blocks of any ROS 2 system. Each node is a modular, independent process responsible for a specific task\u2014controlling a motor, processing sensor data, or planning a path. This section teaches you how to create nodes and enable them to communicate effectively."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"understanding-nodes",children:"Understanding Nodes"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-a-node",children:"What is a Node?"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"node"})," is an executable process that performs computation. In a humanoid robot:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Perception Node"}),": Processes camera/LiDAR data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Localization Node"}),": Estimates robot position"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Planning Node"}),": Computes navigation paths"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Control Node"}),": Sends commands to motors"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Principle"}),": ",(0,i.jsx)(n.strong,{children:"One node, one purpose"}),". Keep nodes focused and modular."]}),"\n",(0,i.jsx)(n.h3,{id:"node-lifecycle",children:"Node Lifecycle"}),"\n",(0,i.jsx)(n.p,{children:"Every node goes through these states:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502 Unconfigured\u2502  (Initial state)\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n       \u2502 configure()\r\n       \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  Inactive   \u2502  (Configured but not running)\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n       \u2502 activate()\r\n       \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502   Active    \u2502  (Fully operational)\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n       \u2502 deactivate()\r\n       \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  Inactive   \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n       \u2502 cleanup() / shutdown()\r\n       \u25bc\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  Finalized  \u2502  (Terminated)\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"topics-publish-subscribe-communication",children:"Topics: Publish-Subscribe Communication"}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-topics",children:"When to Use Topics"}),"\n",(0,i.jsx)(n.p,{children:"Use topics for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Continuous data streams (sensor readings, robot pose)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 One-to-many or many-to-many communication"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Asynchronous, fire-and-forget messaging"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Don't use topics for"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u274c Request-reply interactions (use services)"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Long-running tasks with feedback (use actions)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-publisher-python",children:"Creating a Publisher (Python)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nSimple publisher node that sends velocity commands.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\n\r\nclass VelocityPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__(\'velocity_publisher\')\r\n        \r\n        # Create publisher for /cmd_vel topic\r\n        self.publisher = self.create_publisher(\r\n            Twist,           # Message type\r\n            \'/cmd_vel\',      # Topic name\r\n            10               # QoS queue size\r\n        )\r\n        \r\n        # Create timer to publish at 10 Hz\r\n        self.timer = self.create_timer(0.1, self.timer_callback)\r\n        self.get_logger().info(\'Velocity Publisher started\')\r\n    \r\n    def timer_callback(self):\r\n        """Publish velocity command every 100ms"""\r\n        msg = Twist()\r\n        msg.linear.x = 0.5   # Move forward at 0.5 m/s\r\n        msg.angular.z = 0.1  # Turn slightly\r\n        \r\n        self.publisher.publish(msg)\r\n        self.get_logger().info(f\'Publishing: linear={msg.linear.x}, angular={msg.angular.z}\')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = VelocityPublisher()\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-subscriber-python",children:"Creating a Subscriber (Python)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nSimple subscriber node that receives velocity commands.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\n\r\nclass VelocitySubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__(\'velocity_subscriber\')\r\n        \r\n        # Create subscription to /cmd_vel topic\r\n        self.subscription = self.create_subscription(\r\n            Twist,\r\n            \'/cmd_vel\',\r\n            self.velocity_callback,\r\n            10\r\n        )\r\n        self.get_logger().info(\'Velocity Subscriber started\')\r\n    \r\n    def velocity_callback(self, msg: Twist):\r\n        """Called whenever a message is received"""\r\n        self.get_logger().info(\r\n            f\'Received: linear={msg.linear.x:.2f}, angular={msg.angular.z:.2f}\'\r\n        )\r\n        \r\n        # Here you would send commands to motors\r\n        # For now, just log the data\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = VelocitySubscriber()\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"running-the-example",children:"Running the Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Start the publisher\r\npython3 velocity_publisher.py\r\n\r\n# Terminal 2: Start the subscriber\r\npython3 velocity_subscriber.py\r\n\r\n# Terminal 3: Inspect the topic\r\nros2 topic list\r\nros2 topic info /cmd_vel\r\nros2 topic echo /cmd_vel\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"services-request-reply-communication",children:"Services: Request-Reply Communication"}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-services",children:"When to Use Services"}),"\n",(0,i.jsx)(n.p,{children:"Use services for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 On-demand computations (inverse kinematics, path planning)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Configuration changes (set parameters, trigger calibration)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Synchronous interactions where you need a response"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Don't use services for"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u274c Continuous data streams (use topics)"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Tasks that take >1 second (use actions)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-service-server-python",children:"Creating a Service Server (Python)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nService server that adds two integers.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\nclass AddTwoIntsServer(Node):\r\n    def __init__(self):\r\n        super().__init__(\'add_two_ints_server\')\r\n        \r\n        # Create service\r\n        self.srv = self.create_service(\r\n            AddTwoInts,\r\n            \'add_two_ints\',\r\n            self.add_two_ints_callback\r\n        )\r\n        self.get_logger().info(\'Add Two Ints service ready\')\r\n    \r\n    def add_two_ints_callback(self, request, response):\r\n        """Handle service request"""\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(\r\n            f\'Request: {request.a} + {request.b} = {response.sum}\'\r\n        )\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = AddTwoIntsServer()\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-service-client-python",children:"Creating a Service Client (Python)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nService client that calls the add_two_ints service.\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\nimport sys\r\n\r\nclass AddTwoIntsClient(Node):\r\n    def __init__(self):\r\n        super().__init__('add_two_ints_client')\r\n        \r\n        # Create client\r\n        self.client = self.create_client(AddTwoInts, 'add_two_ints')\r\n        \r\n        # Wait for service to be available\r\n        while not self.client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Waiting for service...')\r\n    \r\n    def send_request(self, a, b):\r\n        \"\"\"Send request to service\"\"\"\r\n        request = AddTwoInts.Request()\r\n        request.a = a\r\n        request.b = b\r\n        \r\n        # Call service asynchronously\r\n        future = self.client.call_async(request)\r\n        rclpy.spin_until_future_complete(self, future)\r\n        \r\n        if future.result() is not None:\r\n            self.get_logger().info(f'Result: {future.result().sum}')\r\n            return future.result().sum\r\n        else:\r\n            self.get_logger().error('Service call failed')\r\n            return None\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    \r\n    if len(sys.argv) != 3:\r\n        print('Usage: add_two_ints_client.py <a> <b>')\r\n        return\r\n    \r\n    node = AddTwoIntsClient()\r\n    result = node.send_request(int(sys.argv[1]), int(sys.argv[2]))\r\n    \r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"running-the-service-example",children:"Running the Service Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Terminal 1: Start the server\r\npython3 add_two_ints_server.py\r\n\r\n# Terminal 2: Call the service\r\npython3 add_two_ints_client.py 5 3\r\n# Output: Result: 8\r\n\r\n# Terminal 3: Inspect the service\r\nros2 service list\r\nros2 service type /add_two_ints\r\nros2 service call /add_two_ints example_interfaces/srv/AddTwoInts "{a: 10, b: 20}"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"actions-long-running-tasks-with-feedback",children:"Actions: Long-Running Tasks with Feedback"}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-actions",children:"When to Use Actions"}),"\n",(0,i.jsx)(n.p,{children:"Use actions for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Tasks that take >1 second (navigation, grasping)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Tasks that need progress feedback"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Tasks that can be canceled mid-execution"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": Navigating to a goal position (takes seconds/minutes, provides distance feedback, can be canceled)."]}),"\n",(0,i.jsx)(n.h3,{id:"action-structure",children:"Action Structure"}),"\n",(0,i.jsx)(n.p,{children:"Actions have three parts:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Goal"}),": What to achieve (e.g., target position)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Feedback"}),": Progress updates (e.g., current distance to goal)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Result"}),": Final outcome (e.g., success/failure)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-an-action-server-python",children:"Creating an Action Server (Python)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nAction server for Fibonacci sequence generation.\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.action import ActionServer\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\nimport time\r\n\r\nclass FibonacciActionServer(Node):\r\n    def __init__(self):\r\n        super().__init__('fibonacci_action_server')\r\n        \r\n        # Create action server\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci',\r\n            self.execute_callback\r\n        )\r\n        self.get_logger().info('Fibonacci Action Server ready')\r\n    \r\n    def execute_callback(self, goal_handle):\r\n        \"\"\"Execute the action\"\"\"\r\n        self.get_logger().info(f'Executing goal: order={goal_handle.request.order}')\r\n        \r\n        # Initialize feedback\r\n        feedback_msg = Fibonacci.Feedback()\r\n        feedback_msg.sequence = [0, 1]\r\n        \r\n        # Generate Fibonacci sequence\r\n        for i in range(1, goal_handle.request.order):\r\n            # Check if goal was canceled\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info('Goal canceled')\r\n                return Fibonacci.Result()\r\n            \r\n            # Compute next number\r\n            feedback_msg.sequence.append(\r\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1]\r\n            )\r\n            \r\n            # Publish feedback\r\n            goal_handle.publish_feedback(feedback_msg)\r\n            self.get_logger().info(f'Feedback: {feedback_msg.sequence}')\r\n            \r\n            time.sleep(0.5)  # Simulate work\r\n        \r\n        # Mark goal as succeeded\r\n        goal_handle.succeed()\r\n        \r\n        # Return result\r\n        result = Fibonacci.Result()\r\n        result.sequence = feedback_msg.sequence\r\n        return result\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = FibonacciActionServer()\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"creating-an-action-client-python",children:"Creating an Action Client (Python)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nAction client for Fibonacci sequence.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.action import ActionClient\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\nclass FibonacciActionClient(Node):\r\n    def __init__(self):\r\n        super().__init__(\'fibonacci_action_client\')\r\n        \r\n        # Create action client\r\n        self._action_client = ActionClient(self, Fibonacci, \'fibonacci\')\r\n    \r\n    def send_goal(self, order):\r\n        """Send goal to action server"""\r\n        goal_msg = Fibonacci.Goal()\r\n        goal_msg.order = order\r\n        \r\n        # Wait for server\r\n        self._action_client.wait_for_server()\r\n        \r\n        # Send goal\r\n        self._send_goal_future = self._action_client.send_goal_async(\r\n            goal_msg,\r\n            feedback_callback=self.feedback_callback\r\n        )\r\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\r\n    \r\n    def goal_response_callback(self, future):\r\n        """Handle goal acceptance/rejection"""\r\n        goal_handle = future.result()\r\n        if not goal_handle.accepted:\r\n            self.get_logger().info(\'Goal rejected\')\r\n            return\r\n        \r\n        self.get_logger().info(\'Goal accepted\')\r\n        \r\n        # Wait for result\r\n        self._get_result_future = goal_handle.get_result_async()\r\n        self._get_result_future.add_done_callback(self.get_result_callback)\r\n    \r\n    def get_result_callback(self, future):\r\n        """Handle final result"""\r\n        result = future.result().result\r\n        self.get_logger().info(f\'Result: {result.sequence}\')\r\n        rclpy.shutdown()\r\n    \r\n    def feedback_callback(self, feedback_msg):\r\n        """Handle feedback"""\r\n        feedback = feedback_msg.feedback\r\n        self.get_logger().info(f\'Feedback: {feedback.sequence}\')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = FibonacciActionClient()\r\n    node.send_goal(10)\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"topics-vs-services-vs-actions",children:"Topics vs. Services vs. Actions"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"Topics"}),(0,i.jsx)(n.th,{children:"Services"}),(0,i.jsx)(n.th,{children:"Actions"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Pattern"})}),(0,i.jsx)(n.td,{children:"Publish-Subscribe"}),(0,i.jsx)(n.td,{children:"Request-Reply"}),(0,i.jsx)(n.td,{children:"Goal-Feedback-Result"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Synchronous?"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"No (with feedback)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"One-to-Many?"})}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Feedback?"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Cancelable?"})}),(0,i.jsx)(n.td,{children:"N/A"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Use Case"})}),(0,i.jsx)(n.td,{children:"Sensor streams"}),(0,i.jsx)(n.td,{children:"Configuration"}),(0,i.jsx)(n.td,{children:"Navigation, grasping"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Duration"})}),(0,i.jsx)(n.td,{children:"Continuous"}),(0,i.jsx)(n.td,{children:"<1 second"}),(0,i.jsx)(n.td,{children:">1 second"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Nodes"})," are modular, independent processes (one node, one purpose)"]}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Topics"})," for continuous, asynchronous data streams (sensor data, commands)"]}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Services"})," for synchronous request-reply (configuration, quick computations)"]}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Actions"})," for long-running tasks with feedback and cancellation (navigation, manipulation)"]}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Choose wisely"}),": Use the right communication pattern for your use case"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"reflection-questions",children:"Reflection Questions"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Why is it better to have many small nodes instead of one large node?"}),"\n",(0,i.jsxs)(n.li,{children:["In a humanoid robot, which communication pattern would you use for:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sending joint angle commands?"}),"\n",(0,i.jsx)(n.li,{children:"Requesting inverse kinematics calculation?"}),"\n",(0,i.jsx)(n.li,{children:'Executing a "walk to position" command?'}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"What happens if a subscriber's callback takes too long to execute?"}),"\n",(0,i.jsx)(n.li,{children:"How would you handle a situation where an action needs to be canceled mid-execution?"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ROS 2 Tutorials"}),": ",(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials.html",children:"docs.ros.org/en/humble/Tutorials"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"rclpy API"}),": ",(0,i.jsx)(n.a,{href:"https://docs.ros2.org/latest/api/rclpy/",children:"docs.ros2.org/latest/api/rclpy"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Action Design"}),": ",(0,i.jsx)(n.a,{href:"https://design.ros2.org/articles/actions.html",children:"design.ros2.org/articles/actions.html"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Previous Section"}),": ",(0,i.jsx)(n.a,{href:"/docs/physical-ai-book/chapter2/ros2-architecture",children:"\u2190 2.1 ROS 2 Architecture"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Next Section"}),": ",(0,i.jsx)(n.a,{href:"/docs/physical-ai-book/chapter2/building-packages",children:"2.3 Building ROS 2 Packages \u2192"})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var s=r(6540);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);